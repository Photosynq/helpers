function MathMULTREG(r){if(void 0===r||!Array.isArray(r))return null;for(var n=r[0].length-1,t=[],e=0;e<r[0].length;e++){for(var a=[],o=0;o<r.length;o++)a.push(r[o][e]);t.push(a)}var u=[],i=[];for(e=0;e<t[0].length;e++)i.push(1);u.push(i);var s=[];for(e=0;e<n;e++)u.push(t[e]),s.push(t[e]);var l=t[n],f=QRDecomp(u=transpose(u)),h=dot(inv(f.R),dot(transpose(f.Q),l)),c=0;for(e=0;e<l.length;e++)c+=l[e];var p=c/l.length,v=[];for(e=0;e<l.length;e++){var g=0;for(o=0;o<n;o++)g+=h[o+1]*u[e][o+1];g+=h[0],v.push(g)}var M=0,m=0;for(e=0;e<l.length;e++)M+=(v[e]-p)*(v[e]-p),m+=(l[e]-p)*(l[e]-p);return{rsquared:M/m,slopes:h,points:[s,v]}}function MathEXPINVREG(r){if(void 0===r||!Array.isArray(r))return null;var n=[];for(u=0;u<r.length;u++)n.push(r[u][1]);var t=0,e=0;for(u=0;u<n.length-1;u++)t+=v=(n[u]+n[u+1])/2,e+=v=(Math.pow(n[u],2)+Math.pow(n[u+1],2))/2;for(var a=(e-t*(n[0]+n[n.length-1])/2)/(t-n.length*(n[0]+n[n.length-1])/2),o=clone(r),u=0;u<r.length;u++)(v=r[u][1]-a)<0&&(v*=-1),o[u][1]=MathLN(v);var i,s,l,f=[.5],h=50;for(u=0;u<10;u++){if(h<2){s=-999999,l=0;break}i=h;var c=MathMULTREG(o.slice(0,h));h=MathROUND(-1/c.slopes[1]*f[0],0),9==u&&(h=h>i?h:i,c=MathMULTREG(o.slice(0,h))),s=c.slopes[1],l=Math.pow(Math.E,c.slopes[0])}var p=[];for(u=0;u<r.length;u++){var v=[];v.push(r[u][0]),v.push(l*Math.pow(Math.E,r[u][0]*s)+a),p.push(v)}var g=0;for(u=0;u<r.length;u++)g+=Math.pow(l*Math.pow(Math.E,r[u][0]*s)-r[u][1]+a,2);var M=-1/s,m=-1*l*s;return{points:p,results:[l,s],error:g/=r.length-1,asymptote:a,rsquared:c.rsquared,lifetime:M,slope:m}}function MathPOLYREG(r,n){for(var t=[],e=0;e<r.length;e++){for(var a=[],o=1;o<n+1;o++)a.push(Math.pow(r[e][0],o));a.push(r[e][1]),t.push(a)}var u=MathMULTREG(t).slopes,i=[],s=0;for(e=0;e<r.length;e++){var l=0;for((a=[]).push(r[e][0]),o=0;o<n+1;o++)l+=Math.pow(r[e][0],n)*u[o];a.push(l),i.push(a),s+=Math.pow(l-r[e][1],2)}return{points:i,slopes:u,error:s/=r.length-1}}function subVV(r,n){for(var t=[],e=0;e<r.length;e++)t.push(r[e]-n[e]);return t}function proj(r,n){for(var t=innerProd(r,r),e=innerProd(r,n),a=[],o=0;o<r.length;o++)a[o]=e/t*r[o];return a}function innerProd(r,n){if(r.length==n.length){for(var t=0,e=0;e<r.length;e++)t+=r[e]*n[e];return t}}function normal(r){for(var n=0,t=0;t<r.length;t++)n+=r[t]*r[t];return n=Math.sqrt(n)}function QRDecomp(r){for(var n=transpose(r),t=[],e=[],a=[],o=[],u=[],i=0;i<n.length;i++){t[i]=[];for(var s=0;s<n[i].length;s++)o[s]=0;for(s=0;s<i;s++){var l=proj(e[s],n[i]);for(c=0;c<l.length;c++)o[c]+=l[c]}for(s=0;s<n[i].length;s++)t[i][s]=n[i][s]-o[s];var f=normal(t[i]);for(e[i]=[],a[i]=[],s=0;s<n[i].length;s++)e[i][s]=t[i][s]/f,a[i][s]=t[i][s]+" / "+f}for(i=0;i<n.length;i++){for(u[i]=[],s=0;s<n[i].length;s++)u[i][s]=0;for(s=0;s<=i;s++)for(var h=innerProd(n[i],e[s]),c=0;c<e[i].length;c++)u[i][c]+=e[s][c]*h}e=transpose(e),a=transpose(a);var p={Q:[]};for(i=0;i<e.length;i++)p.Q[i]=a[i];for(i=0;i<e.length;i++)p.Q[i]=e[i];return p.R=dot(transpose(p.Q),r),p}function transpose(r){var n,t,e,a,o,u=r.length,i=r[0].length,s=new Array(i);for(t=0;t<i;t++)s[t]=new Array(u);for(n=u-1;n>=1;n-=2){for(a=r[n],e=r[n-1],t=i-1;t>=1;--t)(o=s[t])[n]=a[t],o[n-1]=e[t],(o=s[--t])[n]=a[t],o[n-1]=e[t];0===t&&((o=s[0])[n]=a[0],o[n-1]=e[0])}if(0===n){for(e=r[0],t=i-1;t>=1;--t)s[t][0]=e[t],s[--t][0]=e[t];0===t&&(s[0][0]=e[0])}return s}function _getCol(r,n,t){var e;for(e=r.length-1;e>0;--e)t[e]=r[e][n],t[--e]=r[e][n];0===e&&(t[0]=r[0][n])}function dotVV(r,n){var t,e,a=r.length,o=r[a-1]*n[a-1];for(t=a-2;t>=1;t-=2)e=t-1,o+=r[t]*n[t]+r[e]*n[e];return 0===t&&(o+=r[0]*n[0]),o}function dotMMbig(r,n){var t,e,a,o=_getCol,u=n.length,i=new Array(u),s=r.length,l=n[0].length,f=new Array(s),h=dotVV;for(--u,e=--s;-1!==e;--e)f[e]=new Array(l);for(e=--l;-1!==e;--e)for(o(n,e,i),a=s;-1!==a;--a)t=r[a],f[a][e]=h(t,i);return f}function _dim(r){for(var n=[];"object"==typeof r;)n.push(r.length),r=r[0];return n}function dim(r){var n;return"object"==typeof r?"object"==typeof(n=r[0])?"object"==typeof n[0]?_dim(r):[r.length,n.length]:[r.length]:[]}function clone(r){for(var n=[],t=0;t<r.length;t++){for(var e=[],a=0;a<r[0].length;a++)e.push(r[t][a]);n.push(e)}return n}function diag(r){var n,t,e,a,o=r.length,u=new Array(o);for(n=o-1;n>=0;n--){for(a=new Array(o),t=n+2,e=o-1;e>=t;e-=2)a[e]=0,a[e-1]=0;for(e>n&&(a[e]=0),a[n]=r[n],e=n-1;e>=1;e-=2)a[e]=0,a[e-1]=0;0===e&&(a[0]=0),u[n]=a}return u}function rep(r,n,t){void 0===t&&(t=0);var e,a=r[t],o=new Array(a);if(t===r.length-1){for(e=a-2;e>=0;e-=2)o[e+1]=n,o[e]=n;return-1===e&&(o[0]=n),o}for(e=a-1;e>=0;e--)o[e]=rep(r,n,t+1);return o}function identity(r){return diag(rep([r],1))}function inv(r){var n,t,e,a,o,u,i,s=dim(r),l=Math.abs,f=s[0],h=s[1],c=clone(r),p=identity(f);for(u=0;u<h;++u){var v=-1,g=-1;for(o=u;o!==f;++o)(i=l(c[o][u]))>g&&(v=o,g=i);for(t=c[v],c[v]=c[u],c[u]=t,a=p[v],p[v]=p[u],p[u]=a,r=t[u],i=u;i!==h;++i)t[i]/=r;for(i=h-1;-1!==i;--i)a[i]/=r;for(o=f-1;-1!==o;--o)if(o!==u){for(n=c[o],e=p[o],r=n[u],i=u+1;i!==h;++i)n[i]-=t[i]*r;for(i=h-1;i>0;--i)e[i]-=a[i]*r,e[--i]-=a[i]*r;0===i&&(e[0]-=a[0]*r)}}return p}function dotMV(r,n){var t,e=r.length,a=new Array(e),o=dotVV;for(t=e-1;t>=0;t--)a[t]=o(r[t],n);return a}function dotVM(r,n){var t,e,a,o,u,i,s;for(a=r.length,o=n[0].length,u=new Array(o),e=o-1;e>=0;e--){for(i=r[a-1]*n[a-1][e],t=a-2;t>=1;t-=2)s=t-1,i+=r[t]*n[t][e]+r[s]*n[s][e];0===t&&(i+=r[0]*n[0][e]),u[e]=i}return u}function dotMMsmall(r,n){var t,e,a,o,u,i,s,l,f,h,c;for(o=r.length,u=n.length,i=n[0].length,s=new Array(o),t=o-1;t>=0;t--){for(l=new Array(i),f=r[t],a=i-1;a>=0;a--){for(h=f[u-1]*n[u-1][a],e=u-2;e>=1;e-=2)c=e-1,h+=f[e]*n[e][a]+f[c]*n[c][a];0===e&&(h+=f[0]*n[0][a]),l[a]=h}s[t]=l}return s}function mulVS(r,n){for(var t=0;t<r.length;t++)r[t]=r[t]*n;return r}function mulSV(r,n){for(var t=0;t<n.length;t++)n[t]=n[t]*r;return n}function dot(r,n){var t=dim;switch(1e3*t(r).length+t(n).length){case 2002:return n.length<10?dotMMsmall(r,n):dotMMbig(r,n);case 2001:return dotMV(r,n);case 1002:return dotVM(r,n);case 1001:return dotVV(r,n);case 1e3:return mulVS(r,n);case 1:return mulSV(r,n);case 0:return r*n;default:throw new Error("numeric.dot only works on vectors and matrices")}}function ArrayNth(r,n,t){if(!Array.isArray(r))return null;if((void 0===t||t<0||null===t)&&(t=0),(void 0===n||n<1||null===n)&&(n=1),!Number.isInteger(n))return null;if(!Number.isInteger(t))return null;if(0==r.length&&(n>1||t>0))return null;var e=[];for(i=t;i<r.length;i+=n)e.push(r[i]);return e}function ArrayRange(r,n,t,e){if(void 0===r||"number"!=typeof r)return null;if(void 0===n&&(n=r,r=0),"number"!=typeof n)return null;if(null==t&&(t=1),"number"!=typeof t||0==t)return null;if(void 0===e&&(e="none"),-1==["none","log","ln","x2"].indexOf(e))return null;for(var a=[];t>0?n>r:n<r;)"none"==e&&a.push(r),"log"==e&&a.push(Math.log(r)/Math.LN10),"ln"==e&&a.push(Math.log(r)),"x2"==e&&a.push(Math.pow(r,2)),r+=t;return a}function ArrayUnZip(r){if(void 0===r||0==r.length||!Array.isArray(r)||!Array.isArray(r[0]))return null;for(var n={x:[],y:[]},t=0,e=r.length;t<e;t++)n.x.push(r[t][0]||null),n.y.push(r[t][1]||null);return n}function ArrayZip(r,n){if(void 0===r||void 0===n||!Array.isArray(r)||!Array.isArray(n)||r.length!=n.length)return null;for(var t=[],e=0,a=r.length;e<a;e++)t.push([r[e],n[e]]);return t}function GetIndexByLabel(r,n,t){if(void 0===r)return null;void 0===t&&(t=!1);var e=n.set.map(function(n,t){return n.label==r?t:null}).filter(Number);return 0==e.length?null:1==e.length?t?e:e[0]:e}function GetLabelLookup(r){var n={};if(void 0===r.set)return null;for(var t in r.set)void 0!==r.set[t].label?(void 0===n[r.set[t].label]&&(n[r.set[t].label]=[]),n[r.set[t].label].push(t)):(void 0===n.unknown&&(n.unknown=[]),n.unknown.push(t));return 0==Object.keys(n).length?null:n}function GetProtocolByLabel(r,n,t){if(void 0===r)return null;void 0===t&&(t=!1);var e=n.set.filter(function(n){return n.label==r});return 0==e.length?null:1==e.length?t?e:e[0]:e}function MathLINREG(r,n){var t=!1,e=r.length;if(e==n.length){for(var a=MathSUM(r),o=MathSUM(n),u=0,i=0,s=0,l=0;l<e;l++)i+=r[l]*n[l],u+=r[l]*r[l],s+=n[l]*n[l];var f=(e*i-a*o)/(e*u-a*a),h=(o-f*a)/e,c=(i-1/e*a*o)/Math.sqrt((u-1/e*Math.pow(a,2))*(s-1/e*Math.pow(o,2)));t={m:f,b:h,r:c,r2:c*c}}return t}function MathLN(r){var n=!1;return r&&(n=Math.log(r)),parseFloat(n)}function MathLOG(r){var n=!1;return r&&(n=Math.log(r)/Math.LN10),parseFloat(n)}function MathMAX(r){var n=!1;if(r&&Array.isArray(r))for(i=0;i<r.length;i++){if(!Number(r[i])&&null!==r[i]&&0!=r[i])return parseFloat(Number(r[i]));n?Number(r[i])>n&&(n=Number(r[i])):n=Number(r[i])}return parseFloat(n)}function MathMEAN(r){var n=!1,t=0;if(r&&Array.isArray(r)){for(var e=0,a=r.length;e<a;e++)if(null!==r[e]){if(!Number(r[e])&&null!==r[e]&&0!=r[e])return parseFloat(!Number(r[e]));n+=Number(r[e]),t++}n/=t}return parseFloat(n)}function MathMEDIAN(r){var n=!1;if(r&&Array.isArray(r)){if(r.some(function(r){return!Number(r)&&null!==r&&0!=r}))return parseFloat(n);(r=r.filter(function(r){return!(null===r||!Number(r)&&0!=r)})).sort(function(r,n){return r<n?-1:r>n?1:0});var t=r.length;t%2==0&&(n=(Number(r[t/2-1])+Number(r[t/2]))/2),Math.abs(t)%2==1&&(n=r[Math.floor(t/2)])}return parseFloat(n)}function MathMIN(r){var n=!1;if(r&&Array.isArray(r))for(i=0;i<r.length;i++){if(!Number(r[i])&&null!==r[i]&&0!=r[i])return parseFloat(Number(r[i]));n?Number(r[i])<n&&(n=Number(r[i])):n=Number(r[i])}return parseFloat(n)}function MathROUND(r,n){n=void 0!==n?n:2;var t=!1;return null===r||"object"==typeof r||""===r?parseFloat(t):0==Number(r)?0:(r&&parseInt(n)>=0&&(t=Math.round(Number(r)*Math.pow(10,n))/Math.pow(10,n)),parseFloat(t))}function MathSTDERR(r){var n=!1;if(r&&Array.isArray(r)){if(r.some(function(r){return!Number(r)&&null!==r&&0!=r}))return parseFloat(n);if(r.length>2){for(var t=!1,e=0,a=0,o=r.length;a<o;a++)if(null!==r[a]){if(!Number(r[a])&&null!==r[a]&&0!=r[a])return parseFloat(!Number(r[a]));t+=Number(r[a]),e++}t/=e;var u=[],i=!1;for(a=0,o=r.length;a<o;a++)if(null!==r[a]){var s=Math.pow(r[a]-t,2);i+=s,u.push(s)}stdev=Math.sqrt(i/e),n=stdev/Math.sqrt(e)}}return parseFloat(n)}function MathSTDEV(r){var n=!1;if(r&&Array.isArray(r)){if(r.some(function(r){return!Number(r)&&null!==r&&0!=r}))return parseFloat(n);if((r=r.filter(function(r){return!(null===r||!Number(r)&&0!=r)})).length>2){for(var t=!1,e=0,a=0,o=r.length;a<o;a++)if(null!==r[a]){if(!Number(r[a])&&null!==r[a]&&0!=r[a])return parseFloat(!Number(r[a]));t+=Number(r[a]),e++}t/=e;var u=[],i=!1;for(a=0,o=r.length;a<o;a++){var s=Math.pow(r[a]-t,2);i+=s,u.push(s)}n=Math.sqrt(i/r.length)}}return parseFloat(n)}function MathSTDEVS(r){var n=!1;if(r&&Array.isArray(r)){if(r.some(function(r){return!Number(r)&&null!==r&&0!=r}))return parseFloat(n);if((r=r.filter(function(r){return!(null===r||!Number(r)&&0!=r)})).length>2){for(var t=!1,e=0,a=0,o=r.length;a<o;a++)if(null!==r[a]){if(!Number(r[a])&&null!==r[a]&&0!=r[a])return parseFloat(!Number(r[a]));t+=Number(r[a]),e++}t/=e;var u=[],i=!1;for(a=0,o=r.length;a<o;a++){var s=Math.pow(r[a]-t,2);i+=s,u.push(s)}n=Math.sqrt(i/(r.length-1))}}return parseFloat(n)}function MathSUM(r){var n=!1;if(r&&Array.isArray(r))for(var t=0,e=r.length;t<e;t++)if(null!==r[t]){if(!Number(r[t])&&0!=r[t]){n=!1;break}n+=Number(r[t])}return parseFloat(n)}function MathVARIANCE(r){var n=!1,t=!1,e=0;if(r&&Array.isArray(r)){if(r.some(function(r){return!Number(r)&&null!==r&&0!=r})||0==r.length)return parseFloat(n);for(var a=0,o=(r=r.filter(function(r){return!(null===r||!Number(r)&&0!=r)})).length;a<o;a++)if(null!==r[a]){if(!Number(r[a])&&null!==r[a]&&0!=r[a])return parseFloat(!Number(r[a]));t+=Number(r[a]),e++}for(t/=e,a=0;a<r.length;a++)n+=Math.pow(r[a]-t,2);n=1/(r.length-1)*n}return parseFloat(n)}function info(r,n){void 0===n.messages&&(n.messages={}),void 0===n.messages.info&&(n.messages.info=[]),n.messages.info.push(r)}function warning(r,n){void 0===n.messages&&(n.messages={}),void 0===n.messages.warning&&(n.messages.warning=[]),n.messages.warning.push(r)}function danger(r,n){void 0===n.messages&&(n.messages={}),void 0===n.messages.danger&&(n.messages.danger=[]),n.messages.danger.push(r)}function NonLinearRegression(r,n){var t={iterations:void 0===n.iterations||n.iterations>2e3?200:n.iterations,cPts:r.length||0,cVar:n.variables||1,cPar:n.initial.length||0,equation:n.equation||"",RelaxF:n.RelaxF||1,SEy:n.SEy||1,yTrans:"Y",x1Trans:"X",x2Trans:"X2",x3Trans:"X3",x4Trans:"X4",x5Trans:"X5",x6Trans:"X6",x7Trans:"X7",x8Trans:"X8",Centered:n.Centered||!1,LeastAbs:n.LeastAbs||!1,cPctile:n.Percentile||50},e={ca:n.initial[0]||0,cb:n.initial[1]||0,cc:n.initial[2]||0,cd:n.initial[3]||0,ce:n.initial[4]||0,cf:n.initial[5]||0,cg:n.initial[6]||0,ch:n.initial[7]||0,sa:1,sb:1,sc:1,sd:1,se:1,sf:1,sg:1,sh:1,pva:0,pvb:0,pvc:0,pvd:0,pve:0,pvf:0,pvg:0,pvh:0};function a(r,n){var t=(r=Math.abs(r))/Math.sqrt(n),e=Math.atan(t);if(1==n)return 1-e/(Math.PI/2);var a=Math.sin(e),u=Math.cos(e);return n%2==1?1-(e+a*u*o(u*u,2,n-3,-1))/(Math.PI/2):1-a*o(u*u,1,n-3,-1)}function o(r,n,t,e){for(var a=1,o=a,u=n;u<=t;)o+=a=a*r*u/(u-e),u+=2;return o}function u(r,n){return r>n?r:n}function i(r){var n;return Math.abs(r)<5e-5&&(r=0),(n=(n=r>=0?" "+(r+5e-5):" "+(r-5e-5)).substring(0,n.indexOf(".")+5)).substring(n.length-10,n.length)}function s(r){var n;return Math.abs(r)<5e-7&&(r=0),(n=(n=r>=0?" "+(r+5e-7):" "+(r-5e-7)).substring(0,n.indexOf(".")+7)).substring(n.length-18,n.length)}function l(r,n){return r*(t.cPar+1)+n}var f=[0,0,0,0,0,0,0,0],h=[1,1,1,1,1,1,1,1],c=[0,0,0,0,0,0,0,0,0],p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],M=[0,0,0,0,0,0,0,0,0],m=0,d=0,b=1,y=0,A=1;function T(r,n,e){r=r;var o=0,T=0,x=0;dgfr=n.cPts-n.cPar;var P=function(r,n){for(var t=.5,e=.5,o=0;e>1e-15;)e/=2,a(o=1/t-1,n)>r?t-=e:t+=e;return o}(.05,dgfr),R=n.cPctile/100,S=e.ca;f[0]=S;var w=e.cb;f[1]=w;var q=e.cc;f[2]=q;var L=e.cd;f[3]=L;var X=e.ce;f[4]=X;var E=e.cf;f[5]=E;var I=e.cg;f[6]=I;var F=e.ch;f[7]=F;var V="Y = "+n.equation+"\n";for(m=1;m<=n.cVar;m++)V+=" x"+m+" ";V+=" Y yc Y-yc SEest YcLo YcHi \n";var C=0;for(Z=0;Z<n.cPar*(n.cPar+1);Z++)p[Z]=0;for(m=1;m<=n.cPts;m++){for(Z=0;Z<n.cVar;Z++)M[Z]=r[m-1][0],v=r[m-1][1];var Q=M[0];"LN(X2)"==n.x1Trans&&(Q=Math.log(M[0])),"SQRT(X2)"==n.x2Trans&&(Q=Math.sqrt(M[0])),"1/X2"==n.x2Trans&&(Q=1/M[0]);var O=Q;M[1];"LN(X2)"==n.x2Trans&&Math.log(M[1]),"SQRT(X2)"==n.x2Trans&&Math.sqrt(M[1]),"1/X2"==n.x2Trans&&1/M[1];M[2];"LN(X3)"==n.x3Trans&&Math.log(M[2]),"SQRT(X3)"==n.x3Trans&&Math.sqrt(M[2]),"1/X3"==n.x3Trans&&1/M[2];M[3];"LN(X4)"==n.x4Trans&&Math.log(M[3]),"SQRT(X4)"==n.x4Trans&&Math.sqrt(M[3]),"1/X4"==n.x4Trans&&1/M[3];M[4];"LN(X5)"==n.x5Trans&&Math.log(M[4]),"SQRT(X5)"==n.x5Trans&&Math.sqrt(M[4]),"1/X5"==n.x5Trans&&1/M[4];M[5];"LN(X6)"==n.x6Trans&&Math.log(M[5]),"SQRT(X6)"==n.x6Trans&&Math.sqrt(M[5]),"1/X6"==n.x6Trans&&1/M[5];M[6];"LN(X7)"==n.x7Trans&&Math.log(M[6]),"SQRT(X7)"==n.x7Trans&&Math.sqrt(M[6]),"1/X7"==n.x7Trans&&1/M[6];M[7];"LN(X8)"==n.x8Trans&&Math.log(M[7]),"SQRT(X8)"==n.x8Trans&&Math.sqrt(M[7]),"1/X8"==n.x8Trans&&1/M[7];var U=N(n.equation,S,w,q,L,X,E,I,F,Q,O);if(Y=r[m-1][1],"Rep"==n.SEy){var G=Y,_=Y*Y;1,G+=Y,_+=Y*Y,Y=G/2;var k=Math.sqrt(Math.abs(_/2-Y*Y)/2)}yo=Y;var D=1;"w"==n.SEy&&(D=v),"Rep"==n.SEy&&(D=k),"Sqrt(Y)"==n.SEy&&(D=Math.sqrt(Y)),0==D&&(D=.001);var j=n.yTrans.toUpperCase(),B=Y;"LN(Y)"==j&&(B=Math.log(Y)),"LN(SQRT)"==j&&(B=Math.sqrt(Y)),"1/Y"==j&&(B=1/Y),"LN(Y)"==j&&(D/=Y),"SQRT(Y)"==j&&(D/=B),"1/Y"==j&&(D=D/Y*Y),Y=B,n.LeastAbs&&(D*=Y<U?u(Math.sqrt(R*Math.abs(Y-U)),.001*Y):u(Math.sqrt((1-R)*Math.abs(Y-U)),.001*Y)),o+=1/(D*D),T+=U/(D*D),x+=(Y-y)*(Y-y)/(D*D);for(var Z=0;Z<n.cPar;Z++){var z=f[Z];if(0==f[Z])var H=1e-4;else H=f[Z]/1e3;f[Z]+=H,S=f[0],w=f[1],q=f[2],L=f[3],X=f[4],E=f[5],I=f[6],F=f[7],ycIncr=N(n.equation,S,w,q,L,X,E,I,F,Q,O),c[Z]=(ycIncr-U)/(H*D),n.Centered&&(f[Z]-=H,S=f[0],w=f[1],q=f[2],L=f[3],X=f[4],E=f[5],I=f[6],F=f[7],ycDecr=N(n.equation,S,w,q,L,X,E,I,F,Q,O),c[Z]=(ycIncr-ycDecr)/(2*H*D)),f[Z]=z,S=f[0],w=f[1],q=f[2],L=f[3],X=f[4],E=f[5],I=f[6],F=f[7]}for(c[n.cPar]=(Y-U)/D,C+=c[n.cPar]*c[n.cPar],Z=0;Z<n.cPar;Z++)for(d=0;d<=n.cPar;d++)p[l(Z,d)]=p[l(Z,d)]+c[Z]*c[d];var J=0;for(Z=0;Z<n.cPar;Z++)for(J+=g[l(Z,Z)]*c[Z]*c[Z],d=Z+1;d<n.cPar;d++)J+=2*g[l(Z,d)]*c[Z]*c[d];var K=U,W=U-P*(J=D*Math.sqrt(J)),$=U+P*J;"LN(Y)"==j&&(K=Math.exp(U),W=Math.exp(W),$=Math.exp($)),"SQRT(Y)"==j&&(K=U*U,W*=W,$*=$),"1/Y"==j&&(K=1/U,W=1/W,$=1/$),V+=i(yo)+i(K)+i(yo-K)+i(J)+i(W)+i($)+"\n"}y=T/(b=o);var rr=((A=x/b)-C/b)/A;for(V+="\nCorr. Coeff. = "+s(Math.sqrt(rr))+"; r*r = "+s(rr),RMS=Math.sqrt(C/u(1,dgfr)),V+="\nRMS Error = "+s(RMS)+"; d.f = "+dgfr+"; SSq = "+s(C)+"\n",AIC=n.cPts*Math.log(C/n.cPts)+2*(n.cPar+1),n.cPts>=n.cPar+2?AICc=AIC+2*(n.cPar+1)*(n.cPar+1+1)/(n.cPts-(n.cPar+1)-1):AICc=AIC,V+="AIC = "+s(AIC)+"; AIC(corrected) = "+s(AICc)+"\n",m=0;m<n.cPar;m++){var nr=p[l(m,m)];for(p[l(m,m)]=1,d=0;d<=n.cPar;d++)p[l(m,d)]=p[l(m,d)]/nr;for(Z=0;Z<n.cPar;Z++)if(m!=Z)for(nr=p[l(Z,m)],p[l(Z,m)]=0,d=0;d<=n.cPar;d++)p[l(Z,d)]=p[l(Z,d)]-nr*p[l(m,d)]}var tr="\nParameter Estimates...\n",er=[];for(m=0;m<n.cPar;m++)f[m]=f[m]+n.RelaxF*p[l(m,n.cPar)],h[m]=RMS*Math.sqrt(p[l(m,m)]),tr+="p"+(m+1)+"="+s(f[m])+" +/- "+s(h[m])+"; p="+i(a(f[m]/h[m],dgfr))+"\n",er.push({name:"P"+(m+1),value:f[m],sd_error:h[m],p:a(f[m]/h[m],dgfr)});var ar="\nCovariance Matrix Terms and Error-Correlations...\n";for(Z=0;Z<n.cPar;Z++)for(d=Z;d<n.cPar;d++)g[l(Z,d)]=p[l(Z,d)]*RMS*RMS,v=p[l(Z,d)]/Math.sqrt(p[l(Z,Z)]*p[l(d,d)]),ar+="B("+(Z+1)+","+(d+1)+")=",Z!=d&&(ar+="B("+(d+1)+","+(Z+1)+")="),ar+=" ",ar+=g[l(Z,d)],ar+="; r="+v+"\n";return{text:V,ParameterEstimates:tr,CovarianceMatrix:ar,r2:s(rr),par:{ca:f[0],sa:h[0],pva:s(a(f[0]/h[0],dgfr)),cb:f[1],sb:h[1],pvb:s(a(f[1]/h[1],dgfr)),cc:f[2],sc:h[2],pvc:s(a(f[2]/h[2],dgfr)),cd:f[3],sd:h[3],pvd:s(a(f[3]/h[3],dgfr)),ce:f[4],se:h[4],pve:s(a(f[4]/h[4],dgfr)),cf:f[5],sf:h[5],pvf:s(a(f[5]/h[5],dgfr)),cg:f[6],sg:h[6],pvg:s(a(f[6]/h[6],dgfr)),ch:f[7],sh:h[7],pvh:s(a(f[7]/h[7],dgfr))},parameters:er,RMS_error:RMS,presets:t}}function N(r,n,t,e,a,o,u,i,s,l,f){if("b + a * e(- x / c)"==r)return t+n*Math.exp(-l/e);if("( a - c ) * e( - b * t ) + c"==r)return(n-e)*Math.exp(-t*f)+e;if("( c + a / ( 1 + b / x ) )"==r)return e+n/(1+t/l);if("( c + a * a / ( 1 + b / x ) )"==r)return e+n*n/(1+t/l);if("function"==typeof r){var h=r.toString().match(/function\s{0,}.*?\(([^)]*)\)/)[1];h=h.split(",").map(function(r){return r.replace(/\/\*.*\*\//,"").trim()}).filter(function(r){return r});var c=[];for(var p in h)"a"==h[p]&&c.push(n),"b"==h[p]&&c.push(t),"c"==h[p]&&c.push(e),"d"==h[p]&&c.push(a),"e"==h[p]&&c.push(o),"f"==h[p]&&c.push(u),"g"==h[p]&&c.push(i),"h"==h[p]&&c.push(s),"x"==h[p]&&c.push(l),"t"==h[p]&&c.push(f);return r.apply(null,c)}return null}var x,P={},R=[];for(it=0;it<t.iterations;it++){var S=T(r,t,e);if(x<=S.RMS_error&&it>1||isNaN(S.RMS_error))break;e=S.par,x=S.RMS_error,P=S,R.push(S.RMS_error)}return P.iterations=it,P.RMS_errors=R,delete P.par,P}function TransformTrace(r,n,t){var e=[];if(void 0===r||-1==["add","subtract","multiply","divide","+","-","*","/","normToMin","normToMax","normToRange","normToIdx","normToVal","ma","sgf","abs","absorbance","absolute"].indexOf(r))return"Unknown Transformation";if(void 0===n||!Array.isArray(n))return"Second parameter needs to be a number array";if(n.findIndex(function(r){return"number"!=typeof r})>-1)return"Provided array contains elements other than numbers";if(["add","subtract","multiply","divide","+","-","*","/"].indexOf(r)>-1){if(void 0===t||!Array.isArray(t)&&"number"!=typeof t)return"Input for second parameter needs to be a number array or number";if(Array.isArray(t)&&n.length!=t.length)return"Provided arrays have different sizes (a1 = "+n.length+", a2 = "+t.length+")";if(Array.isArray(t)&&t.findIndex(function(r){return"number"!=typeof r})>-1)return"The second array contains elements other than numbers"}else{if(["normToIdx","normToVal"].indexOf(r)>-1&&"number"!=typeof t)return"This transformation requires the second parameter to be a number";if(["abs","absorbance"].indexOf(r)>-1){if(void 0!==t&&"number"!=typeof t)return"This transformation requires the second parameter to be a number or left empty"}else{if(["normToMin","normToMax","normToRange","ma","sgf","absolute"].indexOf(r)>-1&&void 0!==t)return"This transformation only allows one input parameter";if(["sgf"].indexOf(r)>-1&&n.length<=6)return"Array has to have a minimum length of 7 elements"}}if("number"==typeof t)e=n.map(function(e){return"add"==r||"+"==r?e+t:"subtract"==r||"-"==r?e-t:"multiply"==r||"*"==r?e*t:"divide"==r||"/"==r||"normToVal"==r?e/t:"normToIdx"==r?e/n[t]:"abs"==r||"absorbance"==r?-Math.log(e/t)/Math.LN10:void 0});else if(void 0===t){if("normToMin"==r){var a=Math.min.apply(Math,n);e=n.map(function(r){return r/a})}if("normToMax"==r){var o=Math.max.apply(Math,n);e=n.map(function(r){return r/o})}if("normToRange"==r){a=Math.min.apply(Math,n),o=Math.max.apply(Math,n);e=n.map(function(r){return(r-a)/(o-a)})}if("ma"==r){var u=[];n.unshift(n[0]),n.push(n[n.length-1]);for(var i=1,s=n.length;i<s-1;i++)u.push((n[i]+n[i-1]+n[i+1])/3);e=u}if("sgf"==r){s=n.length;var l=n[0],f=n[1],h=n[2],c=n[s-1],p=n[s-2],v=n[s-3];u=[];n.unshift(h,f,l),n.push(c,p,v);for(i=3;i<s-3;i++)u.push((-2*n[i-3]+3*n[i-2]+6*n[i-1]+7*n[i]+6*n[i+1]+3*n[i+2]+-2*n[i+2])/21);e=u}"abs"!=r&&"absorbance"!=r||(e=n.map(function(r,n,t){return-Math.log(r/t[0])/Math.LN10})),"absolute"==r&&(e=n.map(function(r){return Math.abs(r)}))}else{if(!Array.isArray(t))return null;e=n.map(function(n,e){return"add"==r||"+"==r?n+t[e]:"subtract"==r||"-"==r?n-t[e]:"multiply"==r||"*"==r?n*t[e]:"divide"==r||"/"==r?n/t[e]:void 0})}return e}